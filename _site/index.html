<!-- 
---
layout: compress
---
-->


<!DOCTYPE html>
<html lang="en">



<head>



<script type="text/javascript">
var host = "http://talumbau.github.io/";
if ((host == window.location.host) && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script>




    <meta charset="utf-8">
    <!-- X-UA --> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta http-equiv="X-UA-Compatible" content="IE=11"/>


<!-- Microsoft Internet Explorer documentMode compatMode setting IE Modus --> 
<script type="text/javascript">
var IE = null;
if (window.navigator.appName == "Microsoft Internet Explorer") {
  if (document.documentMode) {
  
    IE = document.documentMode; 
    } else {
   
        IE = 5; 
          if (document.compatMode) {
      if (document.compatMode == "CSS1Compat")
      IE = 11; 
      }
    }
  }
</script>

    <!-- Viewport --> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- index ROBOTS follow --> 
    <meta name="robots"    content="index, follow" />
    <!-- Site Desciption --> 
    <meta name="description" content="T.J. Alumbaugh. Can't Stop/Won't Stop Python Developer for Continuum.">
        <!-- Site Desciption --> 
    <meta name="keywords" content="T.J. Alumbaugh">
    <!-- Blog Title -->
    <title>T.J. Alumbaugh- Python Developer @ Continuum. Currently Residing in Austin, TX. </title>

    <!--     <title>T.J. Alumbaugh</title>
--> 
    <!-- Property Metas --> 
    <meta property="og:image" content="img/skydiving_profile.png"/>
    <meta property="og:title" content="T.J. Alumbaugh. Can't Stop/Won't Stop Python Developer for Continuum."/>
    <meta property="og:site_name" content="T.J. Alumbaugh. Can't Stop/Won't Stop Python Developer for Continuum."/>
    <!-- Canonical -->
    <link rel="canonical" href="http://talumbau.github.io/">
    <!-- StyleSheet -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/spaceg.stylesheets.css">
    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900,400italic,700italic,900italic' rel='stylesheet' type='text/css'>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
      

    <!-- <link href="https://gist-assets.github.com/assets/embed-b67021dc07195830cc157f7720b938fb.css" rel="stylesheet" type="text/css">  -->
    <!-- Loading front stylesheet here --> 
    <style>
    ul, ol 
    {margin-top: 0;margin-bottom: 10px;list-style: none;}
        .navbar-inverse 
                {background-color: #FFF;border-color: #FFFFFF;}
            header.intro-header 
                    {background: #6f5499;background: no-repeat top center;background-attachment: scroll;
                -webkit-background-size: 
                cover;-moz-background-size: 
                cover;background-size: 
                cover;-o-background-size: 
                cover;
                }
            /* Preloader */
            #preloader 
                {position:fixed;top:0;left:0;right:0;bottom:0;background-color:#fff; 
            /* change if the mask should have another color then white */z-index:99; 
            /* makes sure it stays on top */}
            #status 
                {width:200px;height:200px;position:absolute;left:50%; 
            /* centers the loading animation horizontally one the screen */top:50%; 
            /* centers the loading animation vertically one the screen */ /*background-image:url(https://spaceg.github.io/img/hex-loader2.gif); */
            /* path to your loading animation */background-repeat:no-repeat;background-position:center;margin:-100px 0 0 -100px; 
            /* is width and height divided by two */} 
            li 
            {list-style: none;}
            body.modal-open 
            {overflow: hidden;padding-right: 0px;
        }
    </style>
    <!-- end Loading front stylesheet here --> 

<!--
    <script type="text/javascript">
// jQuery to collapse the navbar on scroll
$(window).scroll(function() {
    if ($(".navbar").offset().top > 50) {
        $(".navbar-fixed-top").addClass("top-nav-collapse");
    } else {
        $(".navbar-fixed-top").removeClass("top-nav-collapse");
    }
});

// jQuery for page scrolling feature - requires jQuery Easing plugin
$(function() {
    $('a.page-scroll').bind('click', function(event) {
        var $anchor = $(this);
        $('html, body').stop().animate({
            scrollTop: $($anchor.attr('href')).offset().top
        }, 1500, 'easeInOutExpo');
        event.preventDefault();
    });
});

// Closes the Responsive Menu on Menu Item Click
$('.navbar-collapse ul li a').click(function() {
    $('.navbar-toggle:visible').click();
});
</script>

-->


</head>




<body>

	
<div id="preloader">
    <div id="status"></div>

</div>  

    
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">




<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>



                <!--
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapses-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button> -->
            <a class="navbar-brand" href="/" id="blog-title-left-top">tj</a>
        </div>   
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
  <li class="dropdown">
        <a href="#portfolioModal2" data-toggle="modal"><i class="fa fa-random" id="icon-top"></i></a>
            <ul class="dropdown-menu"></ul>
            </li>
             <!--   <li><a class="navbar-brand portfolio-link" href="#portfolioModal1" data-toggle="modal"><img src="/img/93TyTG3x.png" id="small-img-nav" width="40" height="40" class="img-circle" alt="newspace"></a></li> -->
                    <li><a href="https://www.twitter.com/talumbau" id="roundbutton"><i class="fa fa-twitter"></i>talumbau</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<!-- Portfolio Modals -->
    <div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-hidden="true" style="padding-right:0px; overflow: hidden;">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h1 class="font-style-inline-small-h1">T.J. Alumbaugh</h1>
                            <hr class="star-primary">
                            <img src="img/skydiving_profile.png" class="img-responsive img-centered" alt="T.J. Alumbaugh">
                            <p class="font-style-inline-small">
                                Hi, my name is T.J. Alumbaugh. Can't Stop/Won't Stop Python Developer. <br>
                                This is a blog to document all of the stuff I have to figure out or wonder about with code.<br>
                                <a href="https://www.twitter.com/talumbau">follow me</a>. <br> 
                                <a href="https://www.github.com/talumbau">    <i class="fa fa-github" id="spaceg-social-modal"></i> </a> 
                                <a href="https://www.twitter.com/talumbau"><i class="fa fa-twitter" id="spaceg-social-modal"></i> </a>    
                            </p>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Menu Modals Add New Sa.21.Feb.2015 03:22:25 -->
    <div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-hidden="true" style="padding-right:0px; overflow: hidden;">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h1 class="font-style-inline-small-h1">l.g</h1>
                            <hr class="star-primary">
                            <p class="font-style-inline-small">
                        <a href="https://www.twitter.com/talumbau">follow</a>. <br> 
                                <a href="https://www.github.com/talumbau">    <i class="fa fa-github" id="spaceg-social-modal"></i> </a> 
                                <a href="https://www.twitter.com/talumbau"><i class="fa fa-twitter" id="spaceg-social-modal"></i> </a>    
                    <li><a href="/">Home</a></li>
                    <li><a href="https://talumbau.github.io/about">About Me</a></li>
                    <li><a href="https://talumbau.github.io/archive/">Archive</a></li>
                            </p>
                      
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Page Header -->
<header class="intro-header" style="background-image: url('/')" alt="T.J. Alumbaugh">
    <div class="container head">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
 <!-- New Adding Front Profile Picture Mo. 6. April 2015 
skydiving_profile.png

<img src="/img/skydiving_profile.png" style="width:100%" alt="T.J. Alumbaugh">
--> 
<div class="hero-block">
                <img class="img-circle portfolio-link" src="/img/skydiving_profile.png"  href="#portfolioModal1" data-toggle="modal" width="150" height="150" alt="T.J. Alumbaugh">
            </div><br><br>
                    <h1 id="top-title-font-weight-bold">T.J. Alumbaugh</h1>
                <!--    <hr class="small"> -->
                    <span class="subheading" id="textfloat">can't stop/won't stop writing Python @ Continuum Analytics <br> Currently living in Austin, TX.<br> My thoughts here are my own.
                       <br> <br>
                       <!--
 <img src="https://pbs.twimg.com/profile_images/559425037925498880/UL8HyKsM_400x400.jpeg" id="small-img-nav" width="40" height="40" class="img-circle" alt="newspace"> -->
                    <i class="fa fa-chevron-down" id="scroll-down"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Main Content -->
<div class="container front-end">
	<div class="row">
		<div class="posts">
			<div class="content">
  
    <article>
			<header class="intro-header" style="background-image: url('/img/cd-background-img.jpg')" style="margin-bottom:-40px;">  
				
				<div class="post-meta">
					<span class="entry-date date published updated">
						<time datetime="2015-09-04T09:00:44-05:00">
							<a href="http://talumbau.github.io/2015/09/04/postgres-how-to-really-really-use-tablespaces/">September 04, 2015</a>
						</time>
					</span>
					<span class="author vcard">
						<span class="fn">
							<a href="http://talumbau.github.io/about/" title="About "></a>
						</span>
					</span>
						
				</div>
		
				
				<h1 class="post-title"><a href="http://talumbau.github.io/2015/09/04/postgres-how-to-really-really-use-tablespaces/" rel="bookmark" title="Postgres: How to Really, Really use Tablespaces" itemprop="url">Postgres: How to Really, Really use Tablespaces</a></h1>
								<h1 class="post-title-readmore"><a href="http://talumbau.github.io/2015/09/04/postgres-how-to-really-really-use-tablespaces/" rel="bookmark" title="Postgres: How to Really, Really use Tablespaces" itemprop="url" id="readmore-link"> ReadMore</a></h1>

				
			</header>

    </article>
	<article class="container hentry">
		<div class="entry-content">
			<h2 class="section-heading">Postgres: How to Really, Really use Tablespaces</h2>

<p>I like PostgresDB, but recently I had a very opaque problem. The documentation (eventually) saved the day, but not before filling up the disk holding <code>/var/lib/pqsql/</code>. Oops. Read on to learn from my terrible, terrible mistakes.</p>

<p>Sometimes, when using an RDMS, you end up with more data that you thought you were going to have. You’ve already committed to having your database on some disk, but that disk is not big enough to hold the next chunk of data you need to import. There are a number of options for how to handle this, but we opted to use <i>tablespaces</i> in Postgres, which allow you to keep the ‘home’ for your data in $PGDATA, but put all of the data for a new table in a new directory (presumably attached to some bigger disk) specified for your tablespace.</p>

<p>As long as this new directory is owned by user <code>postgres</code>, you should be good to go. So I happily attempted to create my new tablespace as follows:</p>

<p><code>
CREATE TABLESPACE extraspace LOCATION '/big_disk/data';
</code></p>

<p>Not so fast! Total and utter failure. No matter how many times you <code>chown</code> that directory to <code>postgres</code>, if it doesn’t work the first time, it’s not going to work. How? Why? Why does Linux hate you so much? Why doesn’t this just work so we go back to reading Hacker News while the data imports? Because SELinux.</p>

<p>Security Enhanced Linux, if turned on for your system, will prevent Postgres from using the filesystem in that way unless you explicitly allow it. Assuming you want to create the tablespace in <code>/big_disk/data</code>, execute this command as root:</p>

<p><code>
chcon system_u:object_r:postgresql_db_t:s0 /big_disk/data
</code></p>

<p>Some additional background information on SELinux issues with Postgres is available <a href="http://www.mmtek.com/dp20090929/node/39">here</a>. Anyway, now you can create a tablespace with the command above. So, now it’s time to make a table using your brand new tablespace! We had a smaller test table that had a sample of the full dataset, so we just need to create a new table just like the old one:</p>

<p><code>
CREATE TABLE IF NOT EXISTS data_all (LIKE data_some INCLUDING CONSTRAINTS INCLUDING DEFAULTS) TABLESPACE extraspace;
</code></p>

<p>OK, now we can <code>pgimport</code> to our heart’s content right? NO. This is where I went wrong and filled up our production server. That was bad. The key is that, although creating the table this way will indeed start filling up the directory designated for your tablespace, the <i>index</i> (or indices if you have more than one) will still be added somewhere in $PGDATA. So your disk won’t fill up as fast, but if you’re importing a terabyte of data with a lot of rows, you’ll still end up putting a lot of data on your main disk. The solution: at table creation time, you must ALSO specify that each index you create uses the new tablespace:</p>

<p><code>
CREATE TABLE IF NOT EXISTS data_all (PRIMARY KEY (id) USING INDEX TABLESPACE extraspace, LIKE some_data INCLUDING CONSTRAINTS INCLUDING DEFAULTS) TABLESPACE extraspace;
</code></p>

<p><code>
CREATE INDEX an_index ON data_all USING btree (col1, col2) TABLESPACE extraspace;
</code></p>

<p>And with <i>that</i>, your data, your primary key index, and an additional index, will all be stored on your new disk. You’ll only get a few kilobytes in PGDATA per 1 GB block file as Postgres ingests the data. Now, start your massive <code>pgimport</code> and go back to reading Hacker News.</p>

		</div>
		<br>
 <div class="[ col-xs-12 ] meine-visitenkarte"
 style="  background-color: #F7F7F7;
padding-left: 20px;
padding-bottom: 20px;
border-radius: 4px;
padding-top: 20px;
text-align: -webkit-center;
line-height: 30px;
border: 1px solid rgba(0, 0, 0, 0.09);
  ">
	<td colspan="999">
	    <a href="">T.J. Alumbaugh</a> 
		<a class="no-border" href=""><img src="img/skydiving_profile.png" width="50" height="50" style="border:2px solid #fff;border-radius:5em;margin:0;"></a> 
		<a href="">follow:</a>
		<a href="https://www.github.com/talumbau"><i class="fa fa-github"></i></a> 
		<a href="https://www.twitter.com/talumbau"><i class="fa fa-twitter"></i></a> 
	</td>
</div>

	</article>

  


  
</div>




<script src="/js/jquery-1.11.1.js"></script>
<script src="/js/jscroll/jquery.jscroll.js"></script>

<script type="text/javascript">
$('.content').jscroll({
    contentSelector: ".content",
    nextSelector: '.next'
});
</script>

		</div>
	</div>
</div>



<hr>









    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/talumbau">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/talumbau">
                            <span class="fa-stack fa-lg">

                              <i class="fa fa-arrow-circle-o-down"></i>
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; T.J. Alumbaugh 2015 - 2016. <br> 2014, 2015 <br> 
                </p>
<div class="col-md-12">
     <p class="copyright text-muted"> Running with
      <!-- ICE AND FIRE THEME https://github.com/SpaceG/iceandfire -->
    <a href="https://github.com/SpaceG/CleanMagicMedium-Jekyll">CleanMagicMedium by Lucas Gatsas.</a> Hosted on <a href="https://pages.github.com/"> Github</a></p>
    </div>
            </div>
        </div>
    </div>
</footer>


<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<script src="/js/spaceg.stylesheets.min.js"></script> 

<script src="/js/bootstrap.min.js "></script>



<script type="text/javascript">
 
    $(window).load(function() { 
      $('#status').fadeOut(); 
      $('#preloader').delay(100).fadeOut('fast'); 
      $('body').delay(50).css({'overflow':'visible'});
    })

</script>  


<script>
  !function ($) {
    $(function(){
      window.prettyPrint && prettyPrint()
    })
  }(window.jQuery)
</script>
 
<!--
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53988504-1', 'auto');
  ga('send', 'pageview');

</script> --> 



</body>

</html>
